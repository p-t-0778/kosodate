<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>子育て支援制度診断</title>
</head>
<body>
  <h1>あなたが使える子育て支援制度</h1>
  <form method="POST">
    <label>都道府県：</label>
    <select name="prefecture" id="prefecture" required>
      <option value="">-- 選択してください --</option>
      {% for pref in prefectures %}
        <option value="{{ pref }}">{{ pref }}</option>
      {% endfor %}
    </select><br>

    <label>地域：</label>
    <select name="city" id="city" required>
      <option value="">-- 都道府県を選択してください --</option>
    </select><br>

    <label>月収（万円）：</label>
    <input type="number" name="income" required><br>

    <label>子どもの人数：</label>
    <input type="number" name="children" required><br>

    <label>子どもの年齢（歳）：</label>
    <input type="number" name="child_age" required><br>

    <label>共働きですか？</label>
    <input type="radio" name="dual_income" value="はい" required> はい
    <input type="radio" name="dual_income" value="いいえ"> いいえ<br>

    <label>障害児がいますか？</label>
    <input type="radio" name="disabled_child" value="はい" required> はい
    <input type="radio" name="disabled_child" value="いいえ"> いいえ<br>

    <label>オンライン申請できる制度のみ表示</label>
    <input type="checkbox" name="online_only"><br>

    <button type="submit">診断する</button>
  </form>

  {% if results %}
    <h2>該当制度一覧</h2>
    <ul>
      {% for row in results %}
      <li>
        <strong>{{ row["制度名"] }}</strong><br>
        内容：{{ row["内容"] }}<br>
        金額：{{ row["金額"] }}<br>
        <a href="{{ row["公式ページURL"] }}" target="_blank">公式ページを見る</a>
      </li>
      {% endfor %}
    </ul>
  {% endif %}

  <script>
    const citySelect = document.getElementById("city");
    const prefectureSelect = document.getElementById("prefecture");
    const prefectureCityMap = {{ prefecture_city_map | safe }};

    prefectureSelect.addEventListener("change", function () {
      const selectedPref = this.value;
      const cities = prefectureCityMap[selectedPref] || [];

      citySelect.innerHTML = "<option value=''>-- 選択してください --</option>";
      cities.forEach(city => {
        const option = document.createElement("option");
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
      });
    });
  </script>
</body>
</html>
